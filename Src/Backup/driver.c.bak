#include "driver.h"

#include "tim.h"


extern DRIVER *driver;

void DRIVER_Init() {
  // priority timer queue
  init_priority_queue();
  // tim3
  HAL_TIM_Base_Start_IT(&htim3);

//   MOTOR *motor_a = (MOTOR *)calloc(1, sizeof(MOTOR));
//   MOTOR *motor_b = (MOTOR *)calloc(1, sizeof(MOTOR));
//   SERVO *servo = (SERVO *)calloc(1, sizeof(SERVO));

  driver = (DRIVER *)calloc(1, sizeof(DRIVER));

//   MOTOR_ENCODER *motor_a_encoder = (MOTOR_ENCODER *)calloc(1, sizeof(MOTOR_ENCODER));
//   MOTOR_ENCODER *motor_b_encoder = (MOTOR_ENCODER *)calloc(1, sizeof(MOTOR_ENCODER));

//   MOTOR_SIGNAL *motor_a_signal = (MOTOR_SIGNAL *)calloc(1, sizeof(MOTOR_SIGNAL));
//   MOTOR_SIGNAL *motor_b_signal = (MOTOR_SIGNAL *)calloc(1, sizeof(MOTOR_SIGNAL));

  driver->servo.servo.htim = &htim1;
  driver->servo.servo.channel = TIM_CHANNEL_4;

  driver->motor_a.encoder.GPIOx = GPIOA;
  driver->motor_a.encoder.pin_a = GPIO_PIN_3;
  driver->motor_a.encoder.pin_b = GPIO_PIN_2;
  driver->motor_a.signal_a.htim = &htim2;
  driver->motor_a.signal_a.channel = TIM_CHANNEL_4;
  driver->motor_a.signal_b.htim = &htim2;
  driver->motor_a.signal_b.channel = TIM_CHANNEL_3;

  driver->motor_b.encoder.GPIOx = GPIOA;
  driver->motor_b.encoder.pin_a = GPIO_PIN_1;
  driver->motor_b.encoder.pin_b = GPIO_PIN_0;
  driver->motor_b.signal_a.htim = &htim2;
  driver->motor_b.signal_a.channel = TIM_CHANNEL_2;
  driver->motor_b.signal_b.htim = &htim2;
  driver->motor_b.signal_b.channel = TIM_CHANNEL_1;

}
